
 <!DOCTYPE HTML>
<html lang="zh_CN.UTF-8">
<head>
  <meta charset="UTF-8">
  
    <title>Mihenkii&#39;s tech blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="mihenkii">
    

    
    <meta property="og:type" content="website">
<meta property="og:title" content="Mihenkii&#39;s tech blog">
<meta property="og:url" content="http://mihenkii.github.io/index.html">
<meta property="og:site_name" content="Mihenkii&#39;s tech blog">
<meta property="og:locale">
<meta property="article:author" content="mihenkii">
<meta name="twitter:card" content="summary">

    
    <link rel="alternative" href="/atom.xml" title="Mihenkii&#39;s tech blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/%02.css">
<link rel="stylesheet" href="/.css">

<meta name="generator" content="Hexo 5.4.0"></head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Mihenkii&#39;s tech blog" title="Mihenkii&#39;s tech blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Mihenkii&#39;s tech blog">Mihenkii&#39;s tech blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:mihenkii.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2022/04/16/two-sum/" title="two-sum" itemprop="url">two-sum</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="mihenkii" target="_blank" itemprop="author">mihenkii</a>
		
  <p class="article-time">
    <time datetime="2022-04-16T09:18:06.000Z" itemprop="datePublished"> Published 2022-04-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h4 id="第一题"><a href="#第一题" class="headerlink" title="第一题"></a>第一题</h4><p>很早之前就知道Leetcode的第一题叫two-sum</p>
<blockquote>
<p>给定一个整数数组 nums 和一个整数目标值 target，请你在该数组中找出 和为目标值 target  的那 两个 整数，并返回它们的数组下标。<br>你可以假设每种输入只会对应一个答案。但是，数组中同一个元素在答案里不能重复出现。<br>你可以按任意顺序返回答案。<br>示例 1：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：nums = [2,7,11,15], target = 9</span><br><span class="line">输出：[0,1]</span><br><span class="line">解释：因为 nums[0] + nums[1] == 9 ，返回 [0, 1] 。</span><br></pre></td></tr></table></figure>

<h4 id="我的解法"><a href="#我的解法" class="headerlink" title="我的解法"></a>我的解法</h4><p>两层for循环, 时间复杂度是O(n2)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">func twoSum(arr []int, target int) []int &#123;</span><br><span class="line"></span><br><span class="line">	for i := 0; i &lt; len(arr); i++ &#123;</span><br><span class="line">		temp := arr[i]</span><br><span class="line">		if temp &gt;= target &#123;</span><br><span class="line">			continue</span><br><span class="line">		&#125;</span><br><span class="line">		another := target - temp</span><br><span class="line"></span><br><span class="line">		for j := len(arr) - 1; j &gt; i; j-- &#123;</span><br><span class="line">			if arr[j] == another &#123;</span><br><span class="line">				return []int&#123;i, j&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return []int&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	s := []int&#123;2, 7, 11, 15&#125;</span><br><span class="line">	ans := twoSum(s, 9)</span><br><span class="line">	fmt.Println(ans)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="别人的思路"><a href="#别人的思路" class="headerlink" title="别人的思路"></a>别人的思路</h4><p>构造一个HashMap，通过O(n)的时间复杂度即可找到结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">func twoSum(arr []int, target int) []int &#123;</span><br><span class="line">	var table = make(map[int]int)</span><br><span class="line">	for k, v := range arr &#123;</span><br><span class="line">	    if v &gt;= target &#123;</span><br><span class="line">	        continue</span><br><span class="line">	   	&#125;</span><br><span class="line">	    table[v] = k</span><br><span class="line">	    another := target - v</span><br><span class="line">	    if table[another] &gt; 0 &#123;</span><br><span class="line">	        return []int&#123;table[another], k&#125;</span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return []int&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h5><p>开始只考虑从左到右先找到第一个值，然后遍历找到另一个值，思维比较固化</p>
<p>这种一边构造hashmap一边找another的方法, 先找到的是another，然后再hashmap里找另一个。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/数据结构和算法/">数据结构和算法</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2022/04/13/n-combination/" title="N个数的全排列" itemprop="url">N个数的全排列</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="mihenkii" target="_blank" itemprop="author">mihenkii</a>
		
  <p class="article-time">
    <time datetime="2022-04-13T11:45:18.000Z" itemprop="datePublished"> Published 2022-04-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>问题: 输入一个数N，打印出1到N的全排列<br>比如输入数字是 3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">123</span><br><span class="line">132</span><br><span class="line">213</span><br><span class="line">231</span><br><span class="line">312</span><br><span class="line">321</span><br></pre></td></tr></table></figure>

<h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>想象成老虎机上的N个格子，每个格子都是在进行1-N的循环，并且不能重复。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">var (</span><br><span class="line">	num    int</span><br><span class="line">	bucket []int // 格子</span><br><span class="line">	flag   []int // 用来记录1-N的数字是否已经使用，防止重复出现</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func fill_bucket(n int) &#123;</span><br><span class="line">	if n &gt; num &#123; //当所有格子都填满，打印一次</span><br><span class="line">		pretty_print(bucket)</span><br><span class="line">		return</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	for i := 1; i &lt;= num; i++ &#123;</span><br><span class="line">		if flag[i] == 1 &#123;</span><br><span class="line">			continue</span><br><span class="line">		&#125;</span><br><span class="line">		bucket[n] = i</span><br><span class="line">		flag[i] = 1</span><br><span class="line">		fill_bucket(n + 1)</span><br><span class="line">		flag[i] = 0</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func pretty_print(bucket []int) &#123;</span><br><span class="line">	for _, s := range bucket &#123;</span><br><span class="line">		if s != 0 &#123;</span><br><span class="line">			fmt.Print(s)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	fmt.Println(&quot;please input a number&quot;)</span><br><span class="line">	fmt.Scanf(&quot;%d&quot;, &amp;num)</span><br><span class="line">	bucket = make([]int, num+1) // 用不到第0个元素</span><br><span class="line">	flag = make([]int, num+1)   // 用不到第0个元素</span><br><span class="line">	fill_bucket(1)              // 从左到右遍历</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/数据结构与算法/">数据结构与算法</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2022/04/08/fibonacci/" title="fibonacci" itemprop="url">fibonacci</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="mihenkii" target="_blank" itemprop="author">mihenkii</a>
		
  <p class="article-time">
    <time datetime="2022-04-08T09:49:04.000Z" itemprop="datePublished"> Published 2022-04-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>fibonacci数列: 1 1 2 3 5 8 13 21…</p>
<p>今天看到了fibonacci的非递归写法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">func fibonacci(n int) int &#123;</span><br><span class="line">	a, b := 0, 1</span><br><span class="line">	for i := 2; i &lt; n; i++ &#123;</span><br><span class="line">		a, b = b, a+b</span><br><span class="line">	&#125;</span><br><span class="line">	return a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func fibonacci(n int) int &#123;</span><br><span class="line">	a, b := 0, 1</span><br><span class="line">	for i := 2; i &lt; n; i++ &#123;</span><br><span class="line">        // 有的编程语言不支持上面的那种a, b = b, a+b写法</span><br><span class="line">        sum := a + b</span><br><span class="line">        a = b</span><br><span class="line">        b = sum</span><br><span class="line">	&#125;</span><br><span class="line">	return a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>递归写法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func fibonacci(n int) int &#123;</span><br><span class="line">    if n == 1 || n == 2 &#123;</span><br><span class="line">        return 1</span><br><span class="line">    &#125;</span><br><span class="line">    return fibonacci(n-1) + fibonacci(n-2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/数据结构与算法/">数据结构与算法</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2022/02/14/centos-nginx-https-letsencrypt/" title="centos-nginx-https-letsencrypt" itemprop="url">centos-nginx-https-letsencrypt</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="mihenkii" target="_blank" itemprop="author">mihenkii</a>
		
  <p class="article-time">
    <time datetime="2022-02-14T06:26:01.000Z" itemprop="datePublished"> Published 2022-02-14</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>早在2014年，Google就鼓励网站使用HTTPS协议，并优先考虑使用HTTPS的网站，从2017年开始，Google Chrome浏览器将非HTTPS的网站标记为不安全。<br><a target="_blank" rel="noopener" href="https://letsencrypt.org/zh-cn/getting-started/">Let’s Encrypt</a> 面向公众提供免费的HTTPS证书, 这里记录Nginx 开启https的过程。</p>
<h2 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h2><p>我最初用Docker运行Tengine，希望将证书申请下来后mount到Docker里，目标是没有问题，但是操作起来过于麻烦，而且没成功，浪费了很多时间。<br>后来改用服务器直接跑Nginx， 并使用最基础的nginx.conf，一切都变得非常容易。</p>
<p><em><strong>尝试新事物的时候，最好是先“跑”起来，然后再研究更优的办法。</strong></em></p>
<ol>
<li>申请HTTPS证书的域名需要可以被公网访问</li>
<li>如果使用Nginx，需要支持ssl, 编译的时候添加<code>--with-http_ssl_module</code></li>
</ol>
<h2 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h2><h4 id="安装Certbot"><a href="#安装Certbot" class="headerlink" title="安装Certbot"></a>安装Certbot</h4><p>服务器需要使用ACME协议从Let’s Encrypt获取证书，我们使用官方推荐的 Certbot ACME客户端。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install epel-release</span><br><span class="line">yum -y install certbot-nginx</span><br></pre></td></tr></table></figure>

<h4 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h4><p>我的服务器无法通过yum安装Nginx，只好自己编译一个。</p>
<p>下载Tengine(Nginx) 源码, 编译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/local/nginx \</span><br><span class="line">      --conf-path=/usr/local/nginx/conf/nginx.conf \</span><br><span class="line">      --sbin-path=/usr/local/nginx/sbin/nginx \</span><br><span class="line">      --pid-path=/var/run/nginx.pid \</span><br><span class="line">      --lock-path=/var/run/lock/nginx.lock \</span><br><span class="line">      --user=www \</span><br><span class="line">      --group=www \</span><br><span class="line">      --http-log-path=/var/log/nginx/access.log \</span><br><span class="line">      --error-log-path=/var/log/nginx/error.log \</span><br><span class="line">      --http-client-body-temp-path=/var/lib/nginx/client-body \</span><br><span class="line">      --http-proxy-temp-path=/var/lib/nginx/proxy \</span><br><span class="line">      --http-fastcgi-temp-path=/var/lib/nginx/fastcgi \</span><br><span class="line">      --http-scgi-temp-path=/var/lib/nginx/scgi \</span><br><span class="line">      --http-uwsgi-temp-path=/var/lib/nginx/uwsgi \</span><br><span class="line">      --with-pcre-jit \</span><br><span class="line">      --with-http_dav_module \</span><br><span class="line">      --with-http_geoip_module \</span><br><span class="line">      --with-http_gunzip_module \</span><br><span class="line">      --with-http_gzip_static_module \</span><br><span class="line">      --with-http_random_index_module \</span><br><span class="line">      --with-http_realip_module \</span><br><span class="line">      --with-http_stub_status_module \</span><br><span class="line">      --with-http_secure_link_module \</span><br><span class="line">      --with-http_ssl_module \</span><br><span class="line">      --with-stream \</span><br><span class="line">      --with-stream_ssl_module \</span><br><span class="line">      --with-http_v2_module \</span><br><span class="line">      --with-http_stub_status_module \</span><br><span class="line">      --with-http_addition_module \</span><br><span class="line">      --with-http_degradation_module \</span><br><span class="line">      --with-http_flv_module \</span><br><span class="line">      --with-http_mp4_module \</span><br><span class="line">      --with-http_sub_module \</span><br><span class="line">      --with-file-aio \</span><br><span class="line">      --with-mail \</span><br><span class="line">      --with-mail_ssl_module \</span><br><span class="line">      --with-jemalloc</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"># certbot会在PATH下找nginx，这里通过软连把nginx放到PATH下</span><br><span class="line">ln -s /usr/local/nginx/sbin/nginx /usr/local/bin/nginx</span><br><span class="line">ln -s /usr/local/nginx/conf /etc/nginx</span><br></pre></td></tr></table></figure>

<p>增加www用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -s /sbin/nologin www</span><br></pre></td></tr></table></figure>

<h4 id="配置Nginx"><a href="#配置Nginx" class="headerlink" title="配置Nginx"></a>配置Nginx</h4><p>在网上随便找了个nginx.conf, 通过最低下的<code>include /etc/nginx/conf.d/*.conf;</code> 加载个人的配置段。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">user  www;</span><br><span class="line"># This number should be, at maximum, the number of CPU cores on your system.</span><br><span class="line">worker_processes auto;</span><br><span class="line"></span><br><span class="line">error_log  /var/log/nginx/error.log error;</span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    # The effective method, used on Linux 2.6+, optmized to serve many clients with each thread.</span><br><span class="line">    use epoll;</span><br><span class="line">    # Determines how many clients will be served by each worker process.</span><br><span class="line">    worker_connections 4000;</span><br><span class="line">    # Accept as many connections as possible, after nginx gets notification about a new connection.</span><br><span class="line">    multi_accept on;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    # Allow the server to close the connection after a client stops responding.</span><br><span class="line">    reset_timedout_connection on;</span><br><span class="line">    client_header_timeout 15;</span><br><span class="line">    # Send the client a &quot;request timed out&quot; if the body is not loaded by this time.</span><br><span class="line">    client_body_timeout 10;</span><br><span class="line">    # If the client stops reading data, free up the stale client connection after this much time.</span><br><span class="line">    send_timeout 15;</span><br><span class="line">    # Timeout for keep-alive connections. Server will close connections after this time.</span><br><span class="line">    keepalive_timeout 30;</span><br><span class="line">    # Number of requests a client can make over the keep-alive connection.</span><br><span class="line">    keepalive_requests 30;</span><br><span class="line"></span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    client_body_buffer_size 128k;</span><br><span class="line">    client_max_body_size 10m;</span><br><span class="line">    proxy_read_timeout 180s;</span><br><span class="line"></span><br><span class="line">    # Compression.</span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_min_length 10240;</span><br><span class="line">    gzip_proxied expired no-cache no-store private auth;</span><br><span class="line">    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml;</span><br><span class="line">    gzip_disable &quot;msie6&quot;;</span><br><span class="line"></span><br><span class="line">    # Sendfile copies data between one FD and other from within the kernel.</span><br><span class="line">    sendfile on;</span><br><span class="line">    # Don&#x27;t buffer data-sends (disable Nagle algorithm).</span><br><span class="line">    tcp_nodelay on;</span><br><span class="line">    # Causes nginx to attempt to send its HTTP response head in one packet,  instead of using partial frames.</span><br><span class="line">    tcp_nopush on;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # Hide web server information</span><br><span class="line">    server_tokens off;</span><br><span class="line">    server_info off;</span><br><span class="line">    server_tag off;</span><br><span class="line"></span><br><span class="line">    # redirect server error pages to the static page</span><br><span class="line">    error_page 404             /404.html;</span><br><span class="line">    error_page 500 502 503 504 /50x.html;</span><br><span class="line"></span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="配置vhost"><a href="#配置vhost" class="headerlink" title="配置vhost"></a>配置vhost</h4><p>下面是我的vhost配置文件, 使用最基础的配置文件</p>
<h1 id="cikii-com-conf"><a href="#cikii-com-conf" class="headerlink" title="cikii.com.conf"></a>cikii.com.conf</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80 default_server;</span><br><span class="line">    listen [::]:80 default_server;</span><br><span class="line">    server_name     cikii.com www.cikii.com;</span><br><span class="line">    root /usr/local/nginx/html/;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="jiu-cikii-com-conf"><a href="#jiu-cikii-com-conf" class="headerlink" title="jiu.cikii.com.conf"></a>jiu.cikii.com.conf</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    listen [::]:80;</span><br><span class="line">    server_name     jiu.cikii.com;</span><br><span class="line">    root /usr/local/nginx/html/;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>重启一次Nginx</p>
<h4 id="申请证书"><a href="#申请证书" class="headerlink" title="申请证书"></a>申请证书</h4><p>给3个域名同时申请证书, 3个证书会写在同一个pem文件里</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certbot --nginx -d cikii.com -d www.cikii.com -d jiu.cikii.com</span><br></pre></td></tr></table></figure>

<p>如果没有报错的话， 我们自己的vhost配置文件已经被certbot改成支持HTTPS的配置了。</p>
<p>最后, 记得在crontab里定时renew证书</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 12 * * * /usr/bin/certbot renew --quiet</span><br></pre></td></tr></table></figure>

<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="https://www.nginx.com/blog/using-free-ssltls-certificates-from-lets-encrypt-with-nginx/">https://www.nginx.com/blog/using-free-ssltls-certificates-from-lets-encrypt-with-nginx/</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/nginx-https-letsencrypt/">nginx https letsencrypt</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2022/01/06/nginx-basic-auth/" title="nginx-basic-auth" itemprop="url">nginx-basic-auth</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="mihenkii" target="_blank" itemprop="author">mihenkii</a>
		
  <p class="article-time">
    <time datetime="2022-01-06T05:56:39.000Z" itemprop="datePublished"> Published 2022-01-06</time>
    
  </p>
</header>
    <div class="article-content">
        
        <blockquote>
<p>公司的安全团队扫描到我的系统后台直接暴露在公网，有安全问题，需要加上Basic Auth鉴权。</p>
</blockquote>
<h4 id="前置要求"><a href="#前置要求" class="headerlink" title="前置要求"></a>前置要求</h4><p>需要安装httpd-tools（Centos）, Debian系列需要安装apache2-utils</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -u httpd-tools</span><br></pre></td></tr></table></figure>

<h4 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>创建htpasswd文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htpasswd -c /usr/local/nginx/conf/htpasswd admin</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在nginx.conf里配置鉴权</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    ...</span><br><span class="line">    auth_basic  &quot;Administrator&#x27;s Area&quot;;</span><br><span class="line">    auth_basic_user_file /usr/local/nginx/conf/htpasswd;</span><br><span class="line"></span><br><span class="line">    # 不需要开启鉴权的path设置成auth_basic off</span><br><span class="line">    location /test/ &#123;</span><br><span class="line">        auth_basic off;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h4><p><a target="_blank" rel="noopener" href="https://docs.nginx.com/nginx/admin-guide/security-controls/configuring-http-basic-authentication/">https://docs.nginx.com/nginx/admin-guide/security-controls/configuring-http-basic-authentication/</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/nginx/">nginx</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2021/10/27/k8s-nginx-pod-mount-ssl/" title="k8s-nginx-pod-mount-ssl" itemprop="url">k8s-nginx-pod-mount-ssl</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="mihenkii" target="_blank" itemprop="author">mihenkii</a>
		
  <p class="article-time">
    <time datetime="2021-10-27T11:55:02.000Z" itemprop="datePublished"> Published 2021-10-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h4 id="0-背景"><a href="#0-背景" class="headerlink" title="0.背景"></a>0.背景</h4><blockquote>
<p>私有化部署的Tengine需要开启HTTPS，挂载自签名的证书</p>
</blockquote>
<h4 id="1-生成证书"><a href="#1-生成证书" class="headerlink" title="1.生成证书"></a>1.生成证书</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># --nodes 不需要密码加密</span><br><span class="line">openssl req -x509 -nodes -days 36500 -newkey rsa:2048 -keyout tls.key -out tls.crt</span><br></pre></td></tr></table></figure>
<p>生成证书的几个字段说明</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Country Name (2 letter code) [AU]:US</span><br><span class="line">State or Province Name (full name) [Some-State]:New York</span><br><span class="line">Locality Name (eg, city) []:New York City</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:Bouncy Castles, Inc.</span><br><span class="line">Organizational Unit Name (eg, section) []:Ministry of Water Slides</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []:server_IP_address</span><br><span class="line">Email Address []:admin@your_domain.com</span><br></pre></td></tr></table></figure>

<h4 id="2-证书Base64编码"><a href="#2-证书Base64编码" class="headerlink" title="2.证书Base64编码"></a>2.证书Base64编码</h4><blockquote>
<p>The values for all keys in the data field have to be base64-encoded strings. If the conversion to base64 string is not desirable, you can choose to specify the stringData field instead, which accepts arbitrary strings as values.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat tls.crt | base64 | xargs -n 100 | sed &#x27;s/ //g&#x27;</span><br><span class="line">cat tls.key | base64 | xargs -n 100 | sed &#x27;s/ //g&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="3-创建Secret对象"><a href="#3-创建Secret对象" class="headerlink" title="3.创建Secret对象"></a>3.创建Secret对象</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  name: tls-certs</span><br><span class="line">  namespace: &#123;&#123; .Release.Namespace &#125;&#125;</span><br><span class="line">type: kubernetes.io/tls</span><br><span class="line">data:</span><br><span class="line">  tls.crt: &quot;将第2步的crt字符串粘贴在这里&quot;</span><br><span class="line">  tls.key: &quot;将第2步的key字符串粘贴在这里&quot;</span><br></pre></td></tr></table></figure>
<h4 id="4-定义Volume"><a href="#4-定义Volume" class="headerlink" title="4.定义Volume"></a>4.定义Volume</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">volumes:</span><br><span class="line">- name: certs</span><br><span class="line">  secret:</span><br><span class="line">    secretName: tls-certs</span><br><span class="line">    defaultMode: 420</span><br><span class="line">- name: nginx-config</span><br><span class="line">  configMap:</span><br><span class="line">    name: tengine-config</span><br><span class="line">    items:</span><br><span class="line">    - key: nginx.conf</span><br><span class="line">      path: nginx.conf</span><br><span class="line">- name: logdir</span><br><span class="line">  emptyDir: &#123;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-定义volumeMount"><a href="#5-定义volumeMount" class="headerlink" title="5.定义volumeMount"></a>5.定义volumeMount</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">volumeMounts:</span><br><span class="line">- mountPath: /etc/nginx/certs</span><br><span class="line">  name: certs</span><br><span class="line">- mountPath: /etc/nginx/nginx.conf</span><br><span class="line">  name: nginx-config</span><br><span class="line">  subPath: nginx.conf</span><br></pre></td></tr></table></figure>

<h4 id="6-参考文档"><a href="#6-参考文档" class="headerlink" title="6.参考文档"></a>6.参考文档</h4><p><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/configuration/secret/">https://kubernetes.io/docs/concepts/configuration/secret/</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/ljx1528/article/details/108491764">https://blog.csdn.net/ljx1528/article/details/108491764</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/micro-chen/p/11794248.html">https://www.cnblogs.com/micro-chen/p/11794248.html</a><br><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-in-ubuntu-18-04">https://www.digitalocean.com/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-in-ubuntu-18-04</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/secert-ssl/">secert ssl</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2021/07/16/number-is-prime/" title="number-is-prime" itemprop="url">number-is-prime</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="mihenkii" target="_blank" itemprop="author">mihenkii</a>
		
  <p class="article-time">
    <time datetime="2021-07-16T08:34:38.000Z" itemprop="datePublished"> Published 2021-07-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p>如何判断一个数字是否是素数</p>
<h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>普通方法：从2..√n，如果n可以被整除， 那么n就不是素数</p>
<p>更高效方法:</p>
<blockquote>
<p>We can improve this method further. Observe that all primes greater than 3 are of the form 6k ± 1, where k is any integer greater than 0. This is because all integers can be expressed as (6k + i), where i = −1, 0, 1, 2, 3, or 4. Note that 2 divides (6k + 0), (6k + 2), and (6k + 4) and 3 divides (6k + 3). So, a more efficient method is to test whether n is divisible by 2 or 3, then to check through all numbers of the form 6k +-1. This is 3 times faster than testing all numbers up to √n.</p>
</blockquote>
<p>所有整数都可以用6k + i表示，其中i = -1, 0, 1, 2, 3, 4，其中6k + 0, 6k + 2, 6k + 4可以被2整除， 6k + 3 可以被3整除.<br>所以，素数一定是包含在 6k-1 或者 6k+1里</p>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;stdbool.h&gt;</span><br><span class="line"></span><br><span class="line">bool is_prime(int n) &#123;</span><br><span class="line"></span><br><span class="line">    if(n &lt; 2) &#123;</span><br><span class="line">        printf(&quot;Input number must greater than 2 what we got is %d\n&quot;, n);</span><br><span class="line">        exit(-1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(n == 2 || n == 3) &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(n%2 == 0 || n %3 == 0) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for (int i=5; i*i&lt;n; i+=6) &#123;</span><br><span class="line">        if(n % i == 0 || n % (i+2) == 0) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    int n;</span><br><span class="line">    printf(&quot;please input a number: &quot;);</span><br><span class="line">    scanf(&quot;%d&quot;, &amp;n);</span><br><span class="line"></span><br><span class="line">    if (is_prime(n)) &#123;</span><br><span class="line">        printf(&quot;%d is prime number&quot;, n);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        printf(&quot;%d is not prime number&quot;, n);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h4><p><a target="_blank" rel="noopener" href="https://alexanderell.is/posts/rpc-from-scratch/">https://alexanderell.is/posts/rpc-from-scratch/</a><br><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Primality_test">https://en.wikipedia.org/wiki/Primality_test</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/数据结构与算法/">数据结构与算法</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2021/07/15/webrtc-ios-video-orientation/" title="webrtc-ios-video-orientation" itemprop="url">webrtc-ios-video-orientation</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="mihenkii" target="_blank" itemprop="author">mihenkii</a>
		
  <p class="article-time">
    <time datetime="2021-07-15T07:32:03.000Z" itemprop="datePublished"> Published 2021-07-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>写了一个通过Webrtc加入视频会议的html页面，使用iPhone手机打开，发现摄像头采集的视频画面旋转了90度, 在视频会议里面人是横向的..<br>PC和Android都没有这个问题</p>
<p>iPhone -&gt; Janus -&gt; OWT</p>
<h2 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h2><ol>
<li>手机采集的视频就不是正向的</li>
<li>OWT服务端渲染时对视频进行了转向</li>
</ol>
<p>我这里手机采集到的是正向的，所以是服务端对视频进行了旋转.<br>在SDP协商里，通过<code>a=extmap:13 urn:3gpp:video-orientation</code> 控制视频旋转角度</p>
<p><strong>注意：每个人遇到的extmap:后面的数字可能不一样</strong></p>
<h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>判断是iPhone手机，就去掉SDP里面的CVO(Coordination of Video Orientation)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function iOS() &#123;</span><br><span class="line"> return [</span><br><span class="line">    &#x27;iPhone Simulator&#x27;,</span><br><span class="line">    &#x27;iPhone&#x27;</span><br><span class="line"> ].includes(navigator.platform)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function createdOffer(description) &#123;</span><br><span class="line">  if(iOS()) &#123;</span><br><span class="line">    var oldsdp = description[&quot;sdp&quot;];</span><br><span class="line">    var pattern=/a=extmap:13 urn:3gpp:video-orientation\r\n/gi;</span><br><span class="line">    var newsdp = oldsdp.replace(pattern,&quot;&quot;);</span><br><span class="line">    description[&quot;sdp&quot;]=newsdp;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>这个办法不是很好，会在真的有旋转画面需求的时候无法使用，在服务器合流的时候判断是否需要旋转应该更好一些。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/epubcn/article/details/101451547">https://blog.csdn.net/epubcn/article/details/101451547</a><br><a target="_blank" rel="noopener" href="https://docs.flashphoner.com/display/WCS52EN/WebRTC+stream+picture+rotation">https://docs.flashphoner.com/display/WCS52EN/WebRTC+stream+picture+rotation</a><br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/9038625/detect-if-device-is-ios">https://stackoverflow.com/questions/9038625/detect-if-device-is-ios</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/webrtc-ios-video-orientation/">webrtc ios video orientation</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2021/07/15/ubuntu-vnc/" title="Ubuntu-VNC" itemprop="url">Ubuntu-VNC</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="mihenkii" target="_blank" itemprop="author">mihenkii</a>
		
  <p class="article-time">
    <time datetime="2021-07-15T02:21:05.000Z" itemprop="datePublished"> Published 2021-07-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>需要使用Easy Connect链接到某单位的VPN，公司电脑不允许安装VPN客户端，因此考虑在阿里云Ubuntu Server上安装VNC，本地Mac通过VNC链接到Ubuntu</p>
<h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><p>我这里直接使用root账号进行的操作，普通账号命令前面加上sudo</p>
<h4 id="安装桌面环境"><a href="#安装桌面环境" class="headerlink" title="安装桌面环境"></a>安装桌面环境</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install xfce4 xfce4-goodies</span><br><span class="line"></span><br><span class="line"># xdm 可能不需要安装</span><br><span class="line">apt install xdm</span><br></pre></td></tr></table></figure>

<h4 id="安装tightvncserver"><a href="#安装tightvncserver" class="headerlink" title="安装tightvncserver"></a>安装tightvncserver</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt install tightvncserver</span><br><span class="line"># xrdp 也是一个远程桌面服务，支持usb，音频</span><br><span class="line">apt install xrdp</span><br></pre></td></tr></table></figure>

<h4 id="启动vncserver"><a href="#启动vncserver" class="headerlink" title="启动vncserver"></a>启动vncserver</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vncserver</span><br></pre></td></tr></table></figure>
<p>此时会提示设置密码, 设置一个自己熟悉的密码，如果需要更改密码，可以使用vncpasswd命令</p>
<h2 id="配置vnc"><a href="#配置vnc" class="headerlink" title="配置vnc"></a>配置vnc</h2><p>需要配置VNC链接到哪个桌面环境<br>首先停掉当前的VNC实例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vncserver -kill :1</span><br></pre></td></tr></table></figure>
<p>备份原始配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv ~/.vnc/xstartup ~/.vnc/xstartup.bak</span><br></pre></td></tr></table></figure>
<p>编辑配置如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># cat ~/.vnc/xstartup</span><br><span class="line">#!/bin/sh</span><br><span class="line">unset SESSION_MANAGER</span><br><span class="line">unset DBUS_SESSION_BUS_ADDRESS</span><br><span class="line">startxfce4 &amp;</span><br></pre></td></tr></table></figure>

<p><strong>如果没有unset那两个变量，通过VNC链接到Ubuntu是灰屏</strong></p>
<h2 id="设置vnc安全链接"><a href="#设置vnc安全链接" class="headerlink" title="设置vnc安全链接"></a>设置vnc安全链接</h2><p>vnc默认没有使用加密通讯，需要使用SSH tunnel来建立安全链接</p>
<p>在你的Mac本地执行如下命令, Windows用户见“参考链接”里面的putty配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 这条命令需要一直运行</span><br><span class="line">ssh -L 59000:localhost:5901 -C -N -l root 47.199.13.30</span><br></pre></td></tr></table></figure>

<p>-L: 参数代表将我本地Mac的59000端口转发到目标机器(47.199.13.30)的IP：port上. 可以理解登录到目标机器以后，在目标机器上执行 localhost:5901<br>-C: 参数代表启用压缩传输<br>-N: 代表ssh只做端口转发，不会执行命令<br>-l: 代表login user</p>
<h2 id="链接VNC"><a href="#链接VNC" class="headerlink" title="链接VNC"></a>链接VNC</h2><p>在Mac上打开Finder，点击Go，选择Connect to Server<br>链接到本机的59000端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vnc://localhost:59000</span><br></pre></td></tr></table></figure>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ol>
<li>VNC安装成功以后，EasyConnect还是没有搞定，可能与xfce桌面环境有关系，建议使用Gnome </li>
<li>Ubuntu默认的浏览器无法使用，提供input/output error<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb</span><br><span class="line">apt install ./google-chrome-stable_current_amd64.deb</span><br><span class="line"></span><br><span class="line"># 在设置里，找到Preferred Applications  -&gt; Web Browser -&gt; Other... 输入/usr/bin/google-chrome</span><br></pre></td></tr></table></figure></li>
<li>浏览器显示中文乱码<br>安装中文字库<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install ttf-wqy-zenhei</span><br><span class="line">apt-get install language-pack-zh-hans</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-vnc-on-ubuntu-20-04">https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-vnc-on-ubuntu-20-04</a><br><a target="_blank" rel="noopener" href="https://cat.pdx.edu/platforms/mac/remote-access/vnc-to-linux/">https://cat.pdx.edu/platforms/mac/remote-access/vnc-to-linux/</a><br><a target="_blank" rel="noopener" href="https://help.ubuntu.com/community/VNC/Servers">https://help.ubuntu.com/community/VNC/Servers</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Ubuntu20-04-VNC/">Ubuntu20.04 VNC</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2021/06/16/docker-commmon-error/" title="docker-commmon-error" itemprop="url">docker-commmon-error</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="mihenkii" target="_blank" itemprop="author">mihenkii</a>
		
  <p class="article-time">
    <time datetime="2021-06-16T02:50:32.000Z" itemprop="datePublished"> Published 2021-06-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h4 id="1-docker-registiry-pull-Error-http-server-gave-HTTP-response-to-HTTPS-client"><a href="#1-docker-registiry-pull-Error-http-server-gave-HTTP-response-to-HTTPS-client" class="headerlink" title="1. docker registiry pull Error http: server gave HTTP response to HTTPS client"></a>1. docker registiry pull Error http: server gave HTTP response to HTTPS client</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull 192.168.0.10:5000/centos</span><br><span class="line">Error response from daemon: Get https://192.168.0.10:5000/v2/: http: server gave HTTP response to HTTPS client</span><br></pre></td></tr></table></figure>
<p>解决办法: 在daemon.json里面添加insecure-registries</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Mac ~/.docker/daemon.json </span><br><span class="line"># Centos: /etc/docker/daemon.json </span><br><span class="line"></span><br><span class="line">&#123;&quot;experimental&quot;:false,&quot;debug&quot;:true,&quot;insecure-registries&quot;:[&quot;192.168.0.10:5000&quot;]&#125;</span><br></pre></td></tr></table></figure>
<p>重启docker</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next&lt;span&gt;&lt;&#x2F;span&gt;</a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  


  

  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/gimp/" title="gimp">gimp<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/数据结构与算法/" title="数据结构与算法">数据结构与算法<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/linux/" title="linux">linux<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/docker-centos/" title="docker centos">docker centos<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/bashrc-bash-profile/" title="bashrc bash_profile">bashrc bash_profile<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/nginx-https-letsencrypt/" title="nginx https letsencrypt">nginx https letsencrypt<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/docker-delete-image/" title="docker-delete-image">docker-delete-image<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/favicon/" title="favicon">favicon<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/github-blog-hexo-jekyll/" title="github blog hexo jekyll">github blog hexo jekyll<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/golang/" title="golang">golang<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/bash-java-c-python-Hello-World/" title="bash java c python Hello World">bash java c python Hello World<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/hexo-posts-pages/" title="hexo posts pages">hexo posts pages<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/secert-ssl/" title="secert ssl">secert ssl<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/linux-history-stamp/" title="linux history stamp">linux history stamp<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/nginx/" title="nginx">nginx<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/pyenv-virtualenv/" title="pyenv virtualenv">pyenv virtualenv<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Ubuntu20-04-VNC/" title="Ubuntu20.04 VNC">Ubuntu20.04 VNC<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/gimp-GIMP-教程/" title="gimp GIMP 教程">gimp GIMP 教程<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/webrtc-ios-video-orientation/" title="webrtc ios video orientation">webrtc ios video orientation<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/win7-centos7/" title="win7 centos7">win7 centos7<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">Weibo</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Larry Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2022 
		
		<a href="/about" target="_blank" title="mihenkii">mihenkii</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>












<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
